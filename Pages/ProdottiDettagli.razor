@page "/products/{id:int}"
@inject HttpClient Http
@inject NavigationManager NavigationManager

<h3>Dettagli Prodotto</h3>

@if (product == null && errorMessage == null)
{
    <p>Caricamento in corso...</p>
}
else if (errorMessage != null)
{
    <div class="error-box">
    <p class="text-danger">@errorMessage</p>
    <button class="btn btn-primary" @onclick="NavigateToHome">Torna alla home</button>
    </div>
}
else
{
    <p><strong>Titolo:</strong> @product.Title</p>
    <p><strong>Prezzo:</strong> @product.Price</p>
    <p><strong>Descrizione:</strong> @product.Description</p>

    <h4>Categoria</h4>
    <p><strong>Nome:</strong> @product.Category.Name</p>
    <p><strong>Immagine:</strong> <img src="@product.Category.Image" alt="@product.Category.Name" /></p>

    <h4>Immagini</h4>
    @foreach (var image in product.Images)
    {
       <img src="@image" alt="Immagine del prodotto" style="width: 100px; height: auto; margin-right: 5px;" />
}
    <button class="btn btn-primary" @onclick="NavigateToHome">Torna alla home</button>
}

@code {
    private Product? product = null;
    private string? errorMessage = null;

    [Parameter] public int id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Recupera i dettagli dell'utente dall'API
            product = await Http.GetFromJsonAsync<Product>($"https://api.escuelajs.co/api/v1/products/{id}");

            if (product == null)
            {
                errorMessage = "Prodotto non trovato.";
            }
        }
        catch (Exception ex)
        {
            // Gestione degli errori
            errorMessage = "Si Ã¨ verificato un errore durante il caricamento dei dettagli del prodotto: " + ex.Message;
        }
    }

    private void NavigateToHome()
    {
        // Naviga verso la homepage
        NavigationManager.NavigateTo("/");
    }

        public class Product
    {
        public int Id { get; set; }
        public string Title { get; set; } = string.Empty;
        public int Price { get; set; }
        public string Description { get; set; } = string.Empty;
        public Category Category { get; set; } = new Category();
        public string[] Images { get; set; } = Array.Empty<string>(); 
    }

    public class Category
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Image { get; set; } = string.Empty;
    }

  
}
